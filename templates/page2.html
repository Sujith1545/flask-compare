<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Page 2</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <script src="{{ url_for('static', filename='page2.js') }}" defer></script>

    <style>
      /* General form styles */
      form {
        max-width: 500px;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background: #f9f9f9;
      }

      label,
      input {
        display: block;
        width: 100%;
        margin-bottom: 10px;
      }

      input[type="text"] {
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }

      input[type="submit"],
      .download-btn,
      .upload-btn,
      .compare-btn {
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
        width: auto;
        position: relative; /* Needed for the loader */
      }

      .download-btn {
        background: #3447db;
        color: white;
      }
      .upload-btn {
        background: #dbbc34;
        color: white;
      }
      .compare-btn {
        background: #e67e22;
        color: white;
      }

      .download-btn:hover {
        background: #2c3e50;
      }
      .upload-btn:hover {
        background: #f39c12;
      }
      .compare-btn:hover {
        background: #d35400;
      }

      /* Flexbox row layout for the buttons */
      .button-row {
        display: flex;
        gap: 10px;
        margin-top: 10px;
      }

      /* Loader styles */
      .loader {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 1.5s linear infinite;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: none; /* Hidden by default */
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Loader container */
      .loader-container {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        position: relative;
      }

      /* Hide loader initially */
      .loader.hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <h1>Welcome to Page 2</h1>

    <!-- Content of Page 2 -->
    <p>This is the content of the second page.</p>

    <!-- Text input form -->
    <form id="submit-text-form">
      <label for="input1">Input 1:</label>
      <input type="text" id="input1" name="input1" />

      <label for="input2">Input 2:</label>
      <input type="text" id="input2" name="input2" />

      <!-- First row: Submit and Download File buttons -->
      <div class="button-row">
        <input type="submit" value="Submit" />
        <input
          type="button"
          class="download-btn"
          id="download-btn-id"
          value="Download File"
        />
      </div>
    </form>

    <form id="upload-file-form" enctype="multipart/form-data">
      <!-- Second row: Upload File and Compare buttons -->
      <div>
        <input
          type="file"
          accept=".xlsx, .csv"
          required
          class="upload-btn"
          id="upload-btn-id"
          name="upload-file"
        />

        <!-- Compare button with loader inside -->
        <div class="button-row loader-container">
          <input
            type="button"
            class="compare-btn"
            id="compare-btn-id"
            value="Compare"
          />
          <div id="compare-loader" class="loader hidden"></div>
        </div>

        <input type="submit" class="submit-btn" value="Submit" />
      </div>
    </form>

    <script>
      // Get the form and file input elements
      const uploadFileForm = document.getElementById("upload-file-form");
      const fileUploadInput = document.getElementById("upload-btn-id");
      const feedback = document.getElementById("feedback"); // Assuming you have a feedback div
      const loader = document.getElementById("loader"); // Assuming you have a loader div

      // Submit event handler for the file upload form
      uploadFileForm.addEventListener("submit", function (event) {
        event.preventDefault(); // Prevent the default form submission

        const file = fileUploadInput.files[0]; // Get the selected file from the file input
        if (!file) {
          feedback.textContent = "No file selected."; // Handle the case where no file was chosen
          return;
        }

        // Show loader
        showLoader("loader");

        // Create a new FormData object from the form
        const formData = new FormData(uploadFileForm); // This will include the file

        // Upload the file using fetch
        fetch("/upload_get_data_file", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            feedback.textContent = "File uploaded successfully!";
          })
          .catch((error) => {
            console.log("error: ", error);
            feedback.textContent = "An error occurred: " + error.message;
          })
          .finally(() => {
            hideLoader("loader"); // Hide the loader after the request is done
          });
      });

      // Function to show the loader
      function showLoader(targetId) {
        document.getElementById(targetId).style.display = "block";
      }

      // Function to hide the loader
      function hideLoader(targetId) {
        document.getElementById(targetId).style.display = "none";
      }
    </script>

    <!-- Feedback and loader -->
    <div id="feedback"></div>
    <div id="loader" class="loader" style="display: none"></div>

    <!-- Link back to the original page -->
    <a href="{{ url_for('index') }}">Back</a>
  </body>
</html>
